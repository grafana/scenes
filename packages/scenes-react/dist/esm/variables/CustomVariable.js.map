{"version":3,"file":"CustomVariable.js","sources":["../../../src/variables/CustomVariable.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { CustomVariable as CustomVariableObject } from '@grafana/scenes';\nimport { useSceneContext } from '../hooks/hooks';\nimport { VariableProps } from './types';\n\nexport interface CustomVariableProps extends VariableProps {\n  query: string;\n  isMulti?: boolean;\n  includeAll?: boolean;\n  children: React.ReactNode;\n}\n\nexport function CustomVariable({\n  query,\n  name,\n  label,\n  hide,\n  initialValue,\n  isMulti,\n  includeAll,\n  children,\n}: CustomVariableProps): React.ReactNode {\n  const scene = useSceneContext();\n  const [variableAdded, setVariableAdded] = useState<boolean>();\n\n  let variable: CustomVariableObject | undefined = scene.findVariable(name);\n\n  if (!variable) {\n    variable = new CustomVariableObject({ name, label, query, value: initialValue, isMulti, includeAll, hide});\n  }\n\n  useEffect(() => {\n    const removeFn = scene.addVariable(variable);\n    setVariableAdded(true);\n    return removeFn;\n  }, [variable, scene, name]);\n\n  useEffect(() => {\n    variable?.setState({\n      label,\n      query,\n      hide,\n      isMulti,\n      includeAll\n    })\n  }, [hide, includeAll, isMulti, label, query, variable]);\n\n  // Need to block child rendering until the variable is added so that child components like RVariableSelect find the variable\n  if (!variableAdded) {\n    return null;\n  }\n\n  return children;\n}\n"],"names":["CustomVariableObject"],"mappings":";;;;AAYO,SAAS,cAAe,CAAA;AAAA,EAC7B,KAAA;AAAA,EACA,IAAA;AAAA,EACA,KAAA;AAAA,EACA,IAAA;AAAA,EACA,YAAA;AAAA,EACA,OAAA;AAAA,EACA,UAAA;AAAA,EACA,QAAA;AACF,CAAyC,EAAA;AACvC,EAAA,MAAM,QAAQ,eAAgB,EAAA,CAAA;AAC9B,EAAA,MAAM,CAAC,aAAA,EAAe,gBAAgB,CAAA,GAAI,QAAkB,EAAA,CAAA;AAE5D,EAAI,IAAA,QAAA,GAA6C,KAAM,CAAA,YAAA,CAAa,IAAI,CAAA,CAAA;AAExE,EAAA,IAAI,CAAC,QAAU,EAAA;AACb,IAAW,QAAA,GAAA,IAAIA,gBAAqB,CAAA,EAAE,IAAM,EAAA,KAAA,EAAO,KAAO,EAAA,KAAA,EAAO,YAAc,EAAA,OAAA,EAAS,UAAY,EAAA,IAAA,EAAK,CAAA,CAAA;AAAA,GAC3G;AAEA,EAAA,SAAA,CAAU,MAAM;AACd,IAAM,MAAA,QAAA,GAAW,KAAM,CAAA,WAAA,CAAY,QAAQ,CAAA,CAAA;AAC3C,IAAA,gBAAA,CAAiB,IAAI,CAAA,CAAA;AACrB,IAAO,OAAA,QAAA,CAAA;AAAA,GACN,EAAA,CAAC,QAAU,EAAA,KAAA,EAAO,IAAI,CAAC,CAAA,CAAA;AAE1B,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,QAAA,IAAA,IAAA,GAAA,KAAA,CAAA,GAAA,QAAA,CAAU,QAAS,CAAA;AAAA,MACjB,KAAA;AAAA,MACA,KAAA;AAAA,MACA,IAAA;AAAA,MACA,OAAA;AAAA,MACA,UAAA;AAAA,KACF,CAAA,CAAA;AAAA,GACF,EAAG,CAAC,IAAM,EAAA,UAAA,EAAY,SAAS,KAAO,EAAA,KAAA,EAAO,QAAQ,CAAC,CAAA,CAAA;AAGtD,EAAA,IAAI,CAAC,aAAe,EAAA;AAClB,IAAO,OAAA,IAAA,CAAA;AAAA,GACT;AAEA,EAAO,OAAA,QAAA,CAAA;AACT;;;;"}