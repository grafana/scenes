{"version":3,"file":"useDataTransformer.js","sources":["../../../src/hooks/useDataTransformer.ts"],"sourcesContent":["import {\n  CustomTransformerDefinition,\n  DataProviderProxy,\n  SceneDataProvider,\n  SceneDataTransformer,\n} from '@grafana/scenes';\nimport { useSceneContext } from './hooks';\nimport { useEffect, useId } from 'react';\nimport { isEqual } from 'lodash';\nimport { DataTransformerConfig } from '@grafana/schema';\n\nexport interface UseDataTransformerOptions {\n  transformations: Array<DataTransformerConfig | CustomTransformerDefinition>;\n  data: SceneDataProvider;\n}\n\nexport function useDataTransformer(options: UseDataTransformerOptions) {\n  const scene = useSceneContext();\n  const key = useId();\n\n  let dataTransformer = scene.findByKey<SceneDataTransformer>(key);\n\n  if (!dataTransformer) {\n    dataTransformer = new SceneDataTransformer({\n      key: key,\n      $data: new DataProviderProxy({ source: options.data.getRef() }),\n      transformations: options.transformations,\n    });\n  }\n\n  useEffect(() => scene.addToScene(dataTransformer), [dataTransformer, scene]);\n\n  useEffect(() => {\n    if (!isEqual(dataTransformer.state.transformations, options.transformations)) {\n      dataTransformer.setState({ transformations: options.transformations });\n      dataTransformer.reprocessTransformations();\n    }\n  }, [dataTransformer, options.transformations]);\n\n  return dataTransformer;\n}\n"],"names":[],"mappings":";;;;;AAgBO,SAAS,mBAAmB,OAAoC,EAAA;AACrE,EAAA,MAAM,QAAQ,eAAgB,EAAA,CAAA;AAC9B,EAAA,MAAM,MAAM,KAAM,EAAA,CAAA;AAElB,EAAI,IAAA,eAAA,GAAkB,KAAM,CAAA,SAAA,CAAgC,GAAG,CAAA,CAAA;AAE/D,EAAA,IAAI,CAAC,eAAiB,EAAA;AACpB,IAAA,eAAA,GAAkB,IAAI,oBAAqB,CAAA;AAAA,MACzC,GAAA;AAAA,MACA,KAAA,EAAO,IAAI,iBAAkB,CAAA,EAAE,QAAQ,OAAQ,CAAA,IAAA,CAAK,MAAO,EAAA,EAAG,CAAA;AAAA,MAC9D,iBAAiB,OAAQ,CAAA,eAAA;AAAA,KAC1B,CAAA,CAAA;AAAA,GACH;AAEA,EAAU,SAAA,CAAA,MAAM,MAAM,UAAW,CAAA,eAAe,GAAG,CAAC,eAAA,EAAiB,KAAK,CAAC,CAAA,CAAA;AAE3E,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,IAAI,CAAC,OAAQ,CAAA,eAAA,CAAgB,MAAM,eAAiB,EAAA,OAAA,CAAQ,eAAe,CAAG,EAAA;AAC5E,MAAA,eAAA,CAAgB,QAAS,CAAA,EAAE,eAAiB,EAAA,OAAA,CAAQ,iBAAiB,CAAA,CAAA;AACrE,MAAA,eAAA,CAAgB,wBAAyB,EAAA,CAAA;AAAA,KAC3C;AAAA,GACC,EAAA,CAAC,eAAiB,EAAA,OAAA,CAAQ,eAAe,CAAC,CAAA,CAAA;AAE7C,EAAO,OAAA,eAAA,CAAA;AACT;;;;"}