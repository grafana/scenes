{"version":3,"file":"LiveNowTimer.js","sources":["../../../src/behaviors/LiveNowTimer.ts"],"sourcesContent":["import { VizPanel } from '../components/VizPanel/VizPanel';\nimport { SceneObjectBase } from '../core/SceneObjectBase';\nimport { sceneGraph } from '../core/sceneGraph';\nimport { SceneObjectState } from '../core/types';\n\ninterface LiveNowTimerState extends SceneObjectState {\n  enabled: boolean;\n}\n\nexport class LiveNowTimer extends SceneObjectBase<LiveNowTimerState> {\n  private timerId: number | undefined = undefined;\n  private static REFRESH_RATE = 100; // ms\n\n  public constructor({ enabled = false }) {\n    super({ enabled });\n    this.addActivationHandler(this._activationHandler);\n  }\n\n  private _activationHandler = () => {\n    if (this.state.enabled) {\n      this.enable();\n    }\n\n    return () => {\n      window.clearInterval(this.timerId);\n      this.timerId = undefined;\n    };\n  };\n\n  public enable() {\n    window.clearInterval(this.timerId);\n    this.timerId = undefined;\n    this.timerId = window.setInterval(() => {\n      const panels = sceneGraph.findAllObjects(this.getRoot(), (obj) => obj instanceof VizPanel) as VizPanel[];\n      for (const panel of panels) {\n        panel.forceRender();\n      }\n    }, LiveNowTimer.REFRESH_RATE);\n    this.setState({ enabled: true });\n  }\n\n  public disable() {\n    window.clearInterval(this.timerId);\n    this.timerId = undefined;\n    this.setState({ enabled: false });\n  }\n\n  public get isEnabled() {\n    return this.state.enabled;\n  }\n}\n"],"names":[],"mappings":";;;;AASO,MAAM,aAAA,GAAN,cAA2B,eAAmC,CAAA;AAAA,EAI5D,WAAY,CAAA,EAAE,OAAU,GAAA,KAAA,EAAS,EAAA;AACtC,IAAM,KAAA,CAAA,EAAE,SAAS,CAAA,CAAA;AAJnB,IAAA,IAAA,CAAQ,OAA8B,GAAA,KAAA,CAAA,CAAA;AAQtC,IAAA,IAAA,CAAQ,qBAAqB,MAAM;AACjC,MAAI,IAAA,IAAA,CAAK,MAAM,OAAS,EAAA;AACtB,QAAA,IAAA,CAAK,MAAO,EAAA,CAAA;AAAA,OACd;AAEA,MAAA,OAAO,MAAM;AACX,QAAO,MAAA,CAAA,aAAA,CAAc,KAAK,OAAO,CAAA,CAAA;AACjC,QAAA,IAAA,CAAK,OAAU,GAAA,KAAA,CAAA,CAAA;AAAA,OACjB,CAAA;AAAA,KACF,CAAA;AAZE,IAAK,IAAA,CAAA,oBAAA,CAAqB,KAAK,kBAAkB,CAAA,CAAA;AAAA,GACnD;AAAA,EAaO,MAAS,GAAA;AACd,IAAO,MAAA,CAAA,aAAA,CAAc,KAAK,OAAO,CAAA,CAAA;AACjC,IAAA,IAAA,CAAK,OAAU,GAAA,KAAA,CAAA,CAAA;AACf,IAAK,IAAA,CAAA,OAAA,GAAU,MAAO,CAAA,WAAA,CAAY,MAAM;AACtC,MAAM,MAAA,MAAA,GAAS,WAAW,cAAe,CAAA,IAAA,CAAK,SAAW,EAAA,CAAC,GAAQ,KAAA,GAAA,YAAe,QAAQ,CAAA,CAAA;AACzF,MAAA,KAAA,MAAW,SAAS,MAAQ,EAAA;AAC1B,QAAA,KAAA,CAAM,WAAY,EAAA,CAAA;AAAA,OACpB;AAAA,KACF,EAAG,cAAa,YAAY,CAAA,CAAA;AAC5B,IAAA,IAAA,CAAK,QAAS,CAAA,EAAE,OAAS,EAAA,IAAA,EAAM,CAAA,CAAA;AAAA,GACjC;AAAA,EAEO,OAAU,GAAA;AACf,IAAO,MAAA,CAAA,aAAA,CAAc,KAAK,OAAO,CAAA,CAAA;AACjC,IAAA,IAAA,CAAK,OAAU,GAAA,KAAA,CAAA,CAAA;AACf,IAAA,IAAA,CAAK,QAAS,CAAA,EAAE,OAAS,EAAA,KAAA,EAAO,CAAA,CAAA;AAAA,GAClC;AAAA,EAEA,IAAW,SAAY,GAAA;AACrB,IAAA,OAAO,KAAK,KAAM,CAAA,OAAA,CAAA;AAAA,GACpB;AACF,CAAA,CAAA;AAzCO,IAAM,YAAN,GAAA,cAAA;AAAM,YAAA,CAEI,YAAe,GAAA,GAAA;;;;"}