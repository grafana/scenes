{"version":3,"file":"GroupByVariableUrlSyncHandler.js","sources":["../../../../src/variables/groupby/GroupByVariableUrlSyncHandler.ts"],"sourcesContent":["import { SceneObjectUrlSyncHandler, SceneObjectUrlValues } from '../../core/types';\nimport { GroupByVariable } from './GroupByVariable';\nimport { toUrlCommaDelimitedString, unescapeUrlDelimiters } from '../utils';\nimport { VariableValue } from '../types';\n\nexport class GroupByVariableUrlSyncHandler implements SceneObjectUrlSyncHandler {\n  public constructor(private _sceneObject: GroupByVariable) {}\n\n  private getKey(): string {\n    return `var-${this._sceneObject.state.name}`;\n  }\n\n  public getKeys(): string[] {\n    if (this._sceneObject.state.skipUrlSync) {\n      return [];\n    }\n\n    return [this.getKey()];\n  }\n\n  public getUrlState(): SceneObjectUrlValues {\n    if (this._sceneObject.state.skipUrlSync) {\n      return {};\n    }\n\n    return { [this.getKey()]: toUrlValues(this._sceneObject.state.value, this._sceneObject.state.text) };\n  }\n\n  public updateFromUrl(values: SceneObjectUrlValues): void {\n    let urlValue = values[this.getKey()];\n\n    if (urlValue != null) {\n      /**\n       * Initial URL Sync happens before scene objects are activated.\n       * We need to skip validation in this case to make sure values set via URL are maintained.\n       */\n      if (!this._sceneObject.isActive) {\n        this._sceneObject.skipNextValidation = true;\n      }\n\n      const { values, texts } = fromUrlValues(urlValue);\n\n      this._sceneObject.changeValueTo(values, texts);\n    }\n  }\n}\n\nfunction toUrlValues(values: VariableValue, texts: VariableValue): string[] {\n  values = Array.isArray(values) ? values : [values];\n  texts = Array.isArray(texts) ? texts : [texts];\n\n  return values.map((value, idx) => {\n    if (value === undefined || value === null) {\n      return '';\n    }\n\n    value = String(value);\n\n    let text = texts[idx];\n    text = text === undefined || text === null ? value : String(text);\n\n    return toUrlCommaDelimitedString(value, text);\n  });\n}\n\nfunction fromUrlValues(urlValues: string | string[]): { values: string[]; texts: string[] } {\n  urlValues = Array.isArray(urlValues) ? urlValues : [urlValues];\n\n  return urlValues.reduce<{ values: string[]; texts: string[] }>(\n    (acc, urlValue) => {\n      const [value, label] = (urlValue ?? '').split(',');\n\n      acc.values.push(unescapeUrlDelimiters(value));\n      acc.texts.push(unescapeUrlDelimiters(label ?? value));\n\n      return acc;\n    },\n    {\n      values: [],\n      texts: [],\n    }\n  );\n}\n"],"names":["values"],"mappings":"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"}