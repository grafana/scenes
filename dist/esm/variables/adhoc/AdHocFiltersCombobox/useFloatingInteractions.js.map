{"version":3,"file":"useFloatingInteractions.js","sources":["../../../../../src/variables/adhoc/AdHocFiltersCombobox/useFloatingInteractions.ts"],"sourcesContent":["import {\n  useFloating,\n  autoUpdate,\n  offset,\n  useRole,\n  useDismiss,\n  useListNavigation,\n  UseFloatingOptions,\n  flip,\n  size,\n  UseListNavigationProps,\n  useInteractions,\n} from '@floating-ui/react';\n\ntype useFloatingInteractionsProps = {\n  open: UseFloatingOptions['open'];\n  onOpenChange: UseFloatingOptions['onOpenChange'];\n  activeIndex: UseListNavigationProps['activeIndex'];\n  setActiveIndex: UseListNavigationProps['onNavigate'];\n  outsidePressIdsToIgnore: string[];\n  listRef: React.MutableRefObject<Array<HTMLElement | null>>;\n  disabledIndicesRef: React.MutableRefObject<number[]>;\n};\n\nexport const MAX_MENU_HEIGHT = 300;\n\nexport const useFloatingInteractions = ({\n  open,\n  onOpenChange,\n  activeIndex,\n  setActiveIndex,\n  outsidePressIdsToIgnore,\n  listRef,\n  disabledIndicesRef,\n}: useFloatingInteractionsProps) => {\n  const { refs, floatingStyles, context } = useFloating<HTMLInputElement>({\n    whileElementsMounted: autoUpdate,\n    open,\n    onOpenChange,\n    placement: 'bottom-start',\n    middleware: [\n      offset(10),\n      flip({ padding: 10 }),\n      size({\n        apply({ availableHeight, availableWidth, elements }) {\n          // limit maxHeight and maxWidth of dropdown\n          elements.floating.style.maxHeight = `${Math.min(MAX_MENU_HEIGHT, availableHeight)}px`;\n          elements.floating.style.maxWidth = `${availableWidth}px`;\n        },\n        padding: 10,\n      }),\n    ],\n    strategy: 'fixed',\n  });\n\n  const role = useRole(context, { role: 'listbox' });\n  const dismiss = useDismiss(context, {\n    // if outside click lands on operator pill, then ignore outside click\n    outsidePress: (event) => {\n      if (event.currentTarget instanceof Element) {\n        const target = event.currentTarget;\n        let idToCompare = target.id;\n        if (target.nodeName === 'path') {\n          idToCompare = target.parentElement?.id || '';\n        }\n\n        if (outsidePressIdsToIgnore.includes(idToCompare)) {\n          return false;\n        }\n      }\n      return true;\n    },\n  });\n  const listNav = useListNavigation(context, {\n    listRef,\n    activeIndex,\n    onNavigate: setActiveIndex,\n    virtual: true,\n    loop: true,\n    disabledIndices: disabledIndicesRef.current,\n  });\n\n  const { getReferenceProps, getFloatingProps, getItemProps } = useInteractions([role, dismiss, listNav]);\n\n  return {\n    refs,\n    floatingStyles,\n    context,\n    getReferenceProps,\n    getFloatingProps,\n    getItemProps,\n  };\n};\n"],"names":[],"mappings":";;AAwBO,MAAM,eAAkB,GAAA,IAAA;AAExB,MAAM,0BAA0B,CAAC;AAAA,EACtC,IAAA;AAAA,EACA,YAAA;AAAA,EACA,WAAA;AAAA,EACA,cAAA;AAAA,EACA,uBAAA;AAAA,EACA,OAAA;AAAA,EACA,kBAAA;AACF,CAAoC,KAAA;AAClC,EAAA,MAAM,EAAE,IAAA,EAAM,cAAgB,EAAA,OAAA,KAAY,WAA8B,CAAA;AAAA,IACtE,oBAAsB,EAAA,UAAA;AAAA,IACtB,IAAA;AAAA,IACA,YAAA;AAAA,IACA,SAAW,EAAA,cAAA;AAAA,IACX,UAAY,EAAA;AAAA,MACV,OAAO,EAAE,CAAA;AAAA,MACT,IAAK,CAAA,EAAE,OAAS,EAAA,EAAA,EAAI,CAAA;AAAA,MACpB,IAAK,CAAA;AAAA,QACH,KAAM,CAAA,EAAE,eAAiB,EAAA,cAAA,EAAgB,UAAY,EAAA;AAEnD,UAAA,QAAA,CAAS,SAAS,KAAM,CAAA,SAAA,GAAY,GAAG,IAAK,CAAA,GAAA,CAAI,iBAAiB,eAAe,CAAA,CAAA,EAAA,CAAA,CAAA;AAChF,UAAS,QAAA,CAAA,QAAA,CAAS,KAAM,CAAA,QAAA,GAAW,CAAG,EAAA,cAAA,CAAA,EAAA,CAAA,CAAA;AAAA,SACxC;AAAA,QACA,OAAS,EAAA,EAAA;AAAA,OACV,CAAA;AAAA,KACH;AAAA,IACA,QAAU,EAAA,OAAA;AAAA,GACX,CAAA,CAAA;AAED,EAAA,MAAM,OAAO,OAAQ,CAAA,OAAA,EAAS,EAAE,IAAA,EAAM,WAAW,CAAA,CAAA;AACjD,EAAM,MAAA,OAAA,GAAU,WAAW,OAAS,EAAA;AAAA,IAElC,YAAA,EAAc,CAAC,KAAU,KAAA;AA1D7B,MAAA,IAAA,EAAA,CAAA;AA2DM,MAAI,IAAA,KAAA,CAAM,yBAAyB,OAAS,EAAA;AAC1C,QAAA,MAAM,SAAS,KAAM,CAAA,aAAA,CAAA;AACrB,QAAA,IAAI,cAAc,MAAO,CAAA,EAAA,CAAA;AACzB,QAAI,IAAA,MAAA,CAAO,aAAa,MAAQ,EAAA;AAC9B,UAAc,WAAA,GAAA,CAAA,CAAA,EAAA,GAAA,MAAA,CAAO,aAAP,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAsB,EAAM,KAAA,EAAA,CAAA;AAAA,SAC5C;AAEA,QAAI,IAAA,uBAAA,CAAwB,QAAS,CAAA,WAAW,CAAG,EAAA;AACjD,UAAO,OAAA,KAAA,CAAA;AAAA,SACT;AAAA,OACF;AACA,MAAO,OAAA,IAAA,CAAA;AAAA,KACT;AAAA,GACD,CAAA,CAAA;AACD,EAAM,MAAA,OAAA,GAAU,kBAAkB,OAAS,EAAA;AAAA,IACzC,OAAA;AAAA,IACA,WAAA;AAAA,IACA,UAAY,EAAA,cAAA;AAAA,IACZ,OAAS,EAAA,IAAA;AAAA,IACT,IAAM,EAAA,IAAA;AAAA,IACN,iBAAiB,kBAAmB,CAAA,OAAA;AAAA,GACrC,CAAA,CAAA;AAED,EAAM,MAAA,EAAE,iBAAmB,EAAA,gBAAA,EAAkB,YAAa,EAAA,GAAI,gBAAgB,CAAC,IAAA,EAAM,OAAS,EAAA,OAAO,CAAC,CAAA,CAAA;AAEtG,EAAO,OAAA;AAAA,IACL,IAAA;AAAA,IACA,cAAA;AAAA,IACA,OAAA;AAAA,IACA,iBAAA;AAAA,IACA,gBAAA;AAAA,IACA,YAAA;AAAA,GACF,CAAA;AACF;;;;"}